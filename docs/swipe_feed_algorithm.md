QuizRoom의 **스와이프 스택**에서는 “무작위(random)”가 아니라,
**유저별 맞춤형 확률 분포 기반 출제**로 설계하는 게 가장 좋아.
즉, **카테고리/태그/난이도 모두 완전랜덤이 아니라 ‘가중 랜덤(weighted random)’**이야.

아래에서 구체적으로 정리해줄게 👇

---

## 🎯 전체 원칙

> “다양성 + 몰입감 + 성장감”
> → 같은 카테고리만 계속 나오면 지루하고, 너무 어려우면 포기하게 되니까
> **적정 난이도와 유저 취향을 섞되, 랜덤성이 유지되어야 함.**

---

## 1️⃣ 카테고리 분포 로직 (category)

| 카테고리           | 설명                      | 대표 태그 예시                  | 이모지 |
| -------------- | ----------------------- | ------------------------- | --- |
| **K-POP / 음악** | 아이돌, 가요, 음원 차트, 콘서트 관련  | 아이브, 뉴진스, 방탄소년단, 멜론, 무대   | 🎵  |
| **예능 / OTT**   | 방송 프로그램, 넷플릭스·쿠팡플레이 콘텐츠 | 놀면뭐하니, 피지컬100, 스우파, 좀비버스  | 📺  |
| **드라마 / 영화**   | 한국·해외 드라마/영화, 배우, 명대사   | DP, 오징어게임, 콘크리트유토피아, MCU  | 🎬  |
| **스포츠 / 게임**   | 축구, 야구, e스포츠, 모바일 게임    | 손흥민, 롤드컵, 포켓몬고, 카트라이더     | ⚽   |
| **테크 / 트렌드**   | 신제품, IT 서비스, 스타트업, AI   | 아이폰, 삼성, 챗GPT, 스타트업, 전자제품 | 💡  |
| **패션 / 라이프**   | 스타일, 브랜드, 뷰티, 일상 트렌드    | 나이키, 무신사, 스타일난다, 향수       | 👗  |
| **시사 / 이슈**    | 사회·정치·경제·문화 이슈          | 총선, 물가, 환경, 글로벌 뉴스        | 🗞️ |
| **상식**    | 두뇌 퀴즈, 과학·역사·언어 상식      | 수도, 위인, 물리, 영어 표현         | ⚡   |

### 📌 원칙

* 세션 진입 시 “대표 카테고리”를 선택(예: 음악/K-POP, 예능/OTT 등)
* 그 카테고리를 중심으로, **인접 카테고리**를 15~25% 정도 섞기

### 📊 예시

| 중심 카테고리  | 인접 분포 예시                          |
| -------- | --------------------------------- |
| K-POP/음악 | 음악 75%, 예능 15%, 패션 7%, 밈 3%    |
| 예능/드라마   | 예능 75%, 드라마 15%, 영화 7%, 밈 3%   |
| 테크/트렌드   | 테크 75%, 상식 15%, 이슈 7%, 밈 3%    |

👉 이렇게 하면 “음악 모드인데 가끔 드라마나 밈 문제”가 나와서 지루하지 않음.

---

## 2️⃣ 태그 분포 로직 (tags)

### 📌 원칙

* 태그는 **카테고리 안의 세부 토픽(예: “아이브”, “넷플릭스”, “갤럭시”, “밈”, “대통령선거”)**
* 서버는 유저가 자주 맞춘/틀린 태그 데이터를 보고 다음 태그 확률을 조정

### ⚙️ 알고리즘 (의사코드)

```ts
// user.skill: { "아이브": 1350, "넷플릭스": 1100, "갤럭시": 1250 }
const weights = tags.map(tag => {
  const skill = user.skill[tag] ?? 1200;
  const freq = recentCorrectRate(tag); // 태그별 최근 정답률
  const w = 1.0 - clamp(Math.abs(skill - targetSkill)/400, 0, 1); // 유저 실력과의 거리
  return { tag, weight: 0.6*w + 0.4*(1 - freq) };
});
const chosenTag = weightedRandom(weights);
```

📈 결과적으로

* 잘 푸는 태그는 조금 덜 자주,
* 잘 못 푸는 태그는 가끔씩,
* 안 본 태그는 탐색적으로 등장.

---

## 3️⃣ 난이도(ELO 기반 difficulty) 출제

### 📌 원칙

* 유저 스킬(ELO) 근처의 문제를 70~80% 비중으로 출제
* 그보다 쉬운 문제 10~15%, 어려운 문제 10~15%는 “도파민 곡선용”

### ⚙️ 예시

| 난이도(ELO)    | 비율  | 의도              |
| ----------- | --- | --------------- |
| Su - 300 이하 | 15% | “내가 성장하고 있다” 체감 |
| Su ± 200    | 70% | 몰입감 중심대         |
| Su + 300 이상 | 15% | 긴장감 유도          |

```ts
const targetElo = user.skill.avg; // or category별 평균
const ranges = [
  { min: targetElo - 400, max: targetElo - 100, weight: 0.15 },
  { min: targetElo - 100, max: targetElo + 100, weight: 0.7 },
  { min: targetElo + 100, max: targetElo + 400, weight: 0.15 }
];
const chosenRange = weightedRandom(ranges);
const candidate = questions.filter(q => q.elo in chosenRange);
return randomPick(candidate);
```

---

## 4️⃣ 랜덤성 vs 예측 가능성

* **무작위 요소**: 질문 순서, 보기 순서, 미세 난이도 오차(±50 ELO)
* **예측 가능한 요소**:

  * “음악 모드인데 스포츠 문제는 안 나옴”
  * “한 세션 안에서는 같은 아이돌 중복 안됨”

---

## 5️⃣ 정리 요약

| 항목    | 로직 요약           | 랜덤성       |
| ----- | --------------- | --------- |
| 카테고리  | 중심 1개 + 인접 1~2개 | 중간 (가중랜덤) |
| 태그    | 유저 실력·선호 기반     | 높음        |
| 난이도   | ELO 매칭 ± 랜덤     | 중간        |
| 보기 순서 | 항상 랜덤 셔플        | 높음        |

---

✅ **한 문장 요약**

> “유저 실력(ELO) 근처의 문제를, 선호 카테고리 중심으로, 태그 다양성을 유지하면서 가중 랜덤으로 출제한다.”

---

## 6️⃣ Implementation Notes

* 서버(`convex/swipe.ts`)는 `CATEGORY_GRAPH`로 메인 카테고리 75% + 인접 25%(15/7/3%) 분포를 만들고, 필터 태그·유저 관심사·스킬 태그를 합쳐 세션별 가중치를 계산한다.
* 최근 120개의 `answers`를 스캔해 태그별 정답률을 계산하며, 잘 맞추는 태그는 weight를 낮추고 못 맞추거나 미경험 태그에는 탐색 보너스를 얹는다.
* 난이도는 태그별 추정 ELO와 비교해 Easy 15% / Core 70% / Challenge 15% 버킷에서 가중 샘플링한다.
* 카테고리·태그·난이도·품질·신선도 점수를 합산 후 0.85~1.15 범위의 랜덤 팩터를 곱해 루렛휠(Weighted Random) 방식으로 `limit` 만큼 질문을 고른다.

👉 이렇게 “취향 유지 + 다양성 + 성장감”을 동시에 잡는 가중 랜덤 출제 로직을 구현했다.
